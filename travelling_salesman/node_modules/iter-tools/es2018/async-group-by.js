"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = curriedGroupBy;

var _asyncIter = _interopRequireDefault(require("./async-iter"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

async function* groupBy(key, iterable) {
  key = key || function (key) {
    return key;
  };

  iterable = (0, _asyncIter.default)(iterable);
  let currentItem;
  let currentKey, previousKey;

  async function* group() {
    while (true) {
      yield currentItem.value;
      currentItem = await iterable.next();
      if (currentItem.done) return;
      currentKey = key(currentItem.value);

      if (previousKey !== currentKey) {
        return;
      }
    }
  }

  ;
  currentItem = await iterable.next();

  while (true) {
    if (currentItem.done) return;
    currentKey = key(currentItem.value);

    if (previousKey !== currentKey) {
      previousKey = currentKey;
      yield [currentKey, group()];
    } else {
      currentItem = await iterable.next();
    }
  }
}

function curriedGroupBy(key, iterable) {
  if (typeof iterable === 'undefined') {
    return iterable => groupBy(key, iterable);
  }

  return groupBy(key, iterable);
}

module.exports = exports["default"];