"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = curriedGroupBy;

var _iter = _interopRequireDefault(require("./iter"));

function* groupBy(key, iterable) {
  key = key || function (key) {
    return key;
  };

  iterable = (0, _iter.default)(iterable);
  let currentItem;
  let currentKey, previousKey;

  function* group() {
    while (true) {
      yield currentItem.value;
      currentItem = iterable.next();
      if (currentItem.done) return;
      currentKey = key(currentItem.value);

      if (previousKey !== currentKey) {
        return;
      }
    }
  }

  ;
  currentItem = iterable.next();

  while (true) {
    if (currentItem.done) return;
    currentKey = key(currentItem.value);

    if (previousKey !== currentKey) {
      previousKey = currentKey;
      yield [currentKey, group()];
    } else {
      currentItem = iterable.next();
    }
  }
}

function curriedGroupBy(key, iterable) {
  if (typeof iterable === 'undefined') {
    return iterable => groupBy(key, iterable);
  }

  return groupBy(key, iterable);
}

module.exports = exports["default"];